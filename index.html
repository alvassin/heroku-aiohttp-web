<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Heroku aiohttp Web Template by sseg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Heroku aiohttp Web Template</h1>
      <h2 class="project-tagline">A project starter template for deploying an aiohttp app to Heroku</h2>
      <a href="https://github.com/sseg/heroku-aiohttp-web" class="btn">View on GitHub</a>
      <a href="https://github.com/sseg/heroku-aiohttp-web/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/sseg/heroku-aiohttp-web/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="heroku-aiohttp-web-template" class="anchor" href="#heroku-aiohttp-web-template" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Heroku aiohttp Web Template</h1>

<p>An opinionated project template for deploying an <a href="https://github.com/KeepSafe/aiohttp/">aiohttp</a>
web app to Heroku, designed to encourage the rapid development and deployment of real-time
front-end features.</p>

<p><strong>NB:</strong> <em>This remains a work-in-progress. Please tread carefully.</em></p>

<h2>
<a id="launch-the-app" class="anchor" href="#launch-the-app" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Launch the app</h2>

<p>Use this button:</p>

<p><a href="https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com/sseg/heroku-aiohttp-template&amp;template=https%3A%2F%2Fgithub.com/sseg/heroku-aiohttp-template"><img src="https://www.herokucdn.com/deploy/button.svg" alt="Deploy"></a></p>

<p>Or alternatively:</p>

<pre><code>$ git clone git@github.com:sseg/heroku-aiohttp-web.git
$ cd heroku-aiohttp-web
$ heroku create
$ heroku buildpacks:set https://github.com/heroku/heroku-buildpack-multi.git
$ heroku config:set ROOT_LOG_LEVEL=INFO
$ git push heroku master
</code></pre>

<h2>
<a id="develop-locally" class="anchor" href="#develop-locally" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Develop locally</h2>

<p>Make sure you have:</p>

<ul>
<li>a Python 3.5+ virtual environment (<a href="https://docs.python.org/3/library/venv.html">venv</a>)</li>
<li>
<a href="https://nodejs.org/en/">node</a> version 4.5+ with <code>npm</code>
</li>
<li>the Heroku CLI tools <a href="https://toolbelt.heroku.com">Heroku Toolbelt</a>
</li>
</ul>

<p>Install the project packages:</p>

<pre><code>$ pip install -r dev-requirements.txt
$ pip-sync
$ npm install -g brunch
$ npm install
</code></pre>

<p>Then run the project with development asset server:</p>

<pre><code>$ chmod +x ./dev_start.sh `# run this just once`
$ ./dev_start.sh
</code></pre>

<p>Or run the app using compiled assets with the Procfile:</p>

<pre><code>$ npm run clean &amp;&amp; npm run build:prod
$ heroku local
</code></pre>

<p>Local config values are defined in the <code>.env</code> file, and invoked when you start
the application using <code>heroku local</code>.</p>

<h3>
<a id="run-the-tests" class="anchor" href="#run-the-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Run the tests</h3>

<p>There are no tests yet... but stay tuned!</p>

<h2>
<a id="application-structure" class="anchor" href="#application-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Application structure</h2>

<h4>
<a id="handlers" class="anchor" href="#handlers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Handlers</h4>

<p><em>aiohttp</em> dispatches requests to handlers which can be either coroutines or functions
that accept a <a href="http://aiohttp.readthedocs.io/en/stable/web_reference.html#aiohttp.web.Request">Request</a> and return a <a href="http://aiohttp.readthedocs.io/en/stable/web_reference.html#aiohttp.web.Response">Response</a>. A base class
<a href="http://aiohttp.readthedocs.io/en/stable/web_reference.html#aiohttp.web.View">aiohttp.web.View</a>
is also provided to help organize handlers into classes, which provides the convenience of
automatically creating an OPTIONS method.  </p>

<h4>
<a id="templates" class="anchor" href="#templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Templates</h4>

<p>This app uses <a href="http://jinja.pocoo.org/">jinja2</a> templates to construct its index
view. Template files are kept in the <em>web/templates</em> directory and compiled by
the <a href="https://github.com/aio-libs/aiohttp_jinja2">aiohttp_jinja2</a> renderer. You might
prefer <a href="https://github.com/aio-libs/aiohttp_mako">mako</a> for templates, or
<a href="https://wiki.python.org/moin/Templating">something</a>
<a href="https://docs.python.org/3/library/string.html#template-strings">else</a>â€”connecting
a new renderer to your handlers is easy.</p>

<h4>
<a id="static-files" class="anchor" href="#static-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Static files</h4>

<p>Javascript and CSS source files are defined in the <em>assets/js</em>
and <em>assets/css</em> directories, respectively. These assets are compiled by
<a href="http://brunch.io/">brunch</a> to the top-level <em>public</em> directory (configuration
in <em>brunch-config.js</em>). You might want to add React or Elm compilation which is
as simple as installing a new <a href="http://brunch.io/plugins">brunch plugin</a>. In
development you can run a file watcher with an HTTP + pushstate server to reload
your page on file changes (this is started with the <em>dev_start.sh</em> script).</p>

<h5>
<a id="production-asset-delivery" class="anchor" href="#production-asset-delivery" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Production asset delivery</h5>

<p>In production the assets are compiled once (triggered during Heroku deployment by
<em>package.json</em>'s postinstall directive). Based on the Python configuration the compiled
assets are served through <em>aiohttp</em> (with the piping handled by
<em>web.utils.assets.AssetManager</em>).</p>

<p><strong>NB:</strong> the <em>aiohttp</em> server is not designed to serve static files, and allowing
it to serve production asset traffic will detrimentally affect your application's
performance. You will either want to expose this application behind a content
delivery proxy (e.g. <a href="https://www.cloudflare.com/">Cloudflare</a>) or reconfigure it
to serve assets from a separate assets server. The <em>brunch</em> asset compiler is
configured here to append checksum digests to asset filenames which facilitates
cache eviction in these scenarios.</p>

<h4>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h4>

<p>This application uses a configuration base file, <em>config/web.yml</em>, which defines
defaults and wraps environment variables. New configuration settings should be added
to this file and refer to new environment variables. For more information on Heroku
app configuration see the <a href="https://devcenter.heroku.com/articles/config-vars">devcenter</a>
docs.</p>

<h2>
<a id="contributions" class="anchor" href="#contributions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributions</h2>

<p>Contributions are welcome! Bugs, feature requests, and unanswered questions can be
reported in the Github issue tracker <a href="https://github.com/sseg/heroku-aiohttp-web/issues">here</a>.
Fixes, enhancements, and suggestions are also gratefully accepted in pull requests.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/sseg/heroku-aiohttp-web">Heroku aiohttp Web Template</a> is maintained by <a href="https://github.com/sseg">sseg</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
